<script type="text/javascript">
    var db;
    var dbReq = indexedDB.open('veteach', 1);
    const url = 'https://n9yz799guk.execute-api.ap-south-1.amazonaws.com/Prod/hello?url=app_api';
    var url_str = window.location.href;
    var window_url = new URL(url_str);
    var search_params = window_url.searchParams;
    var url_page = search_params.get('url');
    var logout = search_params.get('logout');
    var subject_id_url = search_params.get('subject_id');
    window.dbversion = -1;


    dbReq.onupgradeneeded = function(event) {
      // Set the db variable to our database so we can use it!
      db = event.target.result;
        console.log("createInitTables@22222222222222222222222");
      // Create an object store named subject. Object stores
      // in databases are where data are stored.
          let db_version = db.createObjectStore('db_version', {autoIncrement: true});
          let subject = db.createObjectStore('subject', {autoIncrement: false});
          let video = db.createObjectStore('video', {autoIncrement: true});
          let users = db.createObjectStore('users', {autoIncrement: true});
          let user_basket = db.createObjectStore('user_basket', {autoIncrement: false});
    }
    dbReq.onsuccess = function(event) {
        console.log("createInitTables@333333333333333333333");
       db = event.target.result;
    }
    dbReq.onerror = function(event) {
        console.log("createInitTables@4444444444444444444444");
      alert('error opening database ' + event.target.errorCode);
    }


    function sendRequest($data,$cmd,$extraData1,$extraData2){
            console.log("sendRequest-1111111111111111"+$cmd);
				$.ajax({
					url: url,
					type: 'POST',
					crossDomain: true,
					dataType: 'json',
					contentType: "application/json; charset=utf-8",
					data: JSON.stringify($data),
					success: function(result) {

						switch($cmd){
							case 100:
							    console.log(getCookie("version")+"extra from db");

							     console.log(result.version+"from response");
								if (getCookie("version") !=  result.version) {//result.version //extradata = db version in cookie
								    console.log("result.version");
								    //clear subject data and version data
                                    createVersion(result.version);
								}else{
								    console.log("else --- result.version");
                                    addSubject(1,1,0);
								}
							break;
                            case 101:
                                // console.log(result.user_id+$extraData1[0]+$extraData1[1]+$extraData1[2]+"");
                                document.cookie = "user_id=" + result.user_id + ";path=/";
                                insertUserDetails(result.user_id,$extraData1[0],$extraData1[1],$extraData1[2],"");
                                break;
                            case 103:
                                if ($extraData1 == 1) {
                                    insertSubjects(result,1);
                                }else{
                                    insertSubjects(result,2);
                                }
                            break;
                            case 104:
                                var purchase_status = result.purchase_status;
                                document.cookie = "purchase_status=" + purchase_status + ";path=/";
                                addVideos();
                                break;
                            case 105:
                                console.log(result);
                                insertVideo(result);
                            break;
                        }

					},

					error: function(xhr, textStatus, error) {
						console.log(xhr.responseText);
						console.log(xhr.statusText);
						console.log(textStatus);
						console.log(error);
					},
			// beforeSend: setHeader
				});
		}

    function commonFunctions() {
        var menuchange = document.getElementById('menuchange');
        if(url_page != "mobile_video_view"){
            menuchange.innerHTML = getCookie("branch_name")+" "+getCookie("year_name")+"(Change)";
        }
        console.log("commonFunctions-777777777777777777");
        if(logout == "logout"){
            logout1();
        }if(url_page == "video_view"){
            console.log("video_viewwwwwwwwwwwwwwwww");
            checkPurchaseStatus();
            // addVideos();

        }else if(url_page == "mobile_video_view"){
            checkPurchaseStatus();
        }else if(url_page == "checkout"){
            cartDetails("1");
        }else if(url_page == "profile"){
            var user_name_div = document.getElementById('user_name');
            var user_name_div1 = document.getElementById('user_name1');
            var user_email_div = document.getElementById('user_email');
            var user_email_div1 = document.getElementById('user_email1');
            var user_phone_div = document.getElementById('user_phone');
            var user_referral_div = document.getElementById('user_referral');

            user_name_div.innerHTML = getCookie("user_name");
            user_name_div1.innerHTML = getCookie("user_name");
            user_email_div.innerHTML = getCookie("user_email");
            user_email_div1.innerHTML = getCookie("user_email");
            user_phone_div.innerHTML = getCookie("user_phone");
            user_referral_div.innerHTML = getCookie("user_referral");
        }else if(url_page == "wishlist"){
            displayWishlist();
        } else{


            var selectedsem1 = document.getElementById('selectedSem1');
            var selectedsem2 = document.getElementById('selectedSem2');

            selectedsem1.innerHTML = getCookie("branch_name")+" "+getCookie("year_name")+" 1st Sem";
            selectedsem2.innerHTML = getCookie("branch_name")+" "+getCookie("year_name")+" 2nd Sem";

            // createInitTables();
            var data = {
                cmd:100
            }
            userData();//show/hide login button in menu
            // console.log(data+getVersion()+"");
            let branch_id=getCookie("branch_id");
            let year_id=getCookie("semester_id");
            if(year_id){
                sendRequest(data,100,getVersion(),0);
            }
        }
    }

    function cartDetails($flag) {
        let tx = db.transaction(['user_basket'], 'readonly');
        let store = tx.objectStore('user_basket');
        // Create a cursor request to get all items in the store, which
        // we collect in the allsubject array

        let req = store.openCursor();
        let allsubjects = [];



        req.onsuccess = function(event) {
            let cursor = event.target.result;
            if (cursor != null) {
                allsubjects.push(cursor.value);
                cursor.continue();
            } else {
                displayCart(allsubjects)
            }
        }
        req.onerror = function(event) {
            alert('error in cursor request ' + event.target.errorCode);
        }
    }

    function displayCart(allsubjects) {
        var checkout_list = document.getElementById('checkout_list');
        for (let i = 0; i < allsubjects.length; i++) {
            var each_subject = JSON.stringify(allsubjects[i]);
            var subjectJsonObj = JSON.parse(each_subject);
            var row = subjectJsonObj;

            var branch_id = row['branch_id'];//decode json
            var discounted_price = row['discounted_price'];//decode json
            var price = row['price'];//decode json
            var regulation = row['regulation'];//decode json
            var semester_id = row['semester_id'];//decode json
            var subject_id = row['subject_id'];//decode json
            var subject_name = row['subject_name'];//decode json
            var subject_photo = row['subject_photo'];//decode json
            var avg_rating = row['avg_rating'];//decode json
            var rating_count = row['rating_count'];//decode json
            var university_id = row['university_id'];//decode json
            var university_name = "JNTUK";
            var user_id = row['user_id'];
            var branch_name = getCookie("branch_name");
            var semester_name = "semester "+semester_id
            var percent1 = (((discounted_price-price)/price)*100)
            var percent = percent1.toFixed(2)+"%"
            var professor_name = ""
            checkout_list.innerHTML += "<div class=\"col-md-12 col-sm-12 col-xs-12 mobile_mode1\"> <div class=\"container\" style=\"margin-top: 10px;border-radius: 10px;background-color: #fff;-webkit-box-shadow: 0 2px 4px 0 rgba(0,0,0,.15);box-shadow: 0 2px 4px 0 rgba(0,0,0,.15);color: #454545;\"> <div class=\"col-md-12 \" style=\"border-bottom: 2px solid #f0f0f0;\"> <div class=\"row\"> <div class=\"col-md-6 col-xs-8 col-sm-8\" > <p style=\"font-size: 11px;word-spacing: 5px;\"> <div class=\"mobile_mode4\" style=\"font-size: 27px;color: #a0a0a0b3;display:inline;\"><b>"+university_name+"</b></div> <b class=\"mobile_mode3\"> | "+regulation+" | "+branch_name+" | "+semester_name+"</b></p> </div> <div class=\"col-md-2 col-xs-4 col-sm-4 pull-right mobil_mode5\" style=\"padding: 20px;\"> <form action=\"\" method=\"post\"> <input type=\"hidden\" name=\"cart_id\" value=\"\" > <button class=\"btn\" type=\"submit\" name=\"remove_from_cart\" style=\" font-weight: 600;\" > <i class=\"fa fa-trash\" aria-hidden=\"true\" style=\"color: #d25151;font-size:20px;\"></i>Remove </button> </form> </div> </div> </div> <div class=\"col-md-3\" style=\" padding: 17px;width: 50%; \"> <img src=\"https://veteachwebfiles.s3.ap-south-1.amazonaws.com/website_files/assets/uploads/"+subject_photo+"\" style=\"border-radius: 15px;\" alt=\"video-classes\"> </div> <div class=\"col-md-5\" style=\"margin: auto;padding-top: 22px;font-size: 19px;\"> <p><b>"+subject_name+"</b></p> <p><span style=\"font-weight: bold;\">&#x20b9; "+discounted_price+"&nbsp;&nbsp;</span><strike style=\"font-size: 16px;color: #9c9b9b;\">&#x20b9; "+price+"</strike><span style=\" font-size: 14px; color: #00b0f0; font-weight: 700;\">&nbsp;"+percent+"%</span></p><h7 style=\"color: #be5a0e;font-weight:600;font-size: 17px;\">485</h7>&nbsp;<span class=\"checked_star fa fa-star\"></span> <span class=\"checked_star fa fa-star\"></span> <span class=\"checked_star fa fa-star\"></span> <span class=\"checked_star fa fa-star\"></span> <span class=\"checked_star fa fa-star\"></span>&nbsp; <h7 style=\"color: #73726c;\">7854</h7><p style=\" display:none; font-size: 11px; font-weight: 990;\">BY-"+professor_name+"</p> </div> <div class=\"col-md-4\" style=\"padding: 31px;\"></div> <div class=\"col-md-12\" style=\"border-top: 2px solid #f0f0f0; height: 30px;\"> <div class=\"row\"> <div class=\"col-md-4\" style=\"text-align:center;\" > <p>Total Orders-2182</p> </div> <div class=\"col-md-4\" style=\"text-align:center;\"> <p>Total Downloads-23</p> </div> <div class=\"col-md-4\" style=\"text-align:center;\"> <p>Total Likes-233</p> </div> </div> </div> </div> </div>";
        }
    }

    function checkPurchaseStatus() {
        var data = {
                cmd:104,
                subject_id:subject_id_url,
                user_id: getCookie("user_id")
            }
        sendRequest(data,104,0,0);
    }

    function displayWishlist() {
        let tx = db.transaction(['user_basket'], 'readonly');
        let store = tx.objectStore('user_basket');
        // Create a cursor request to get all items in the store, which
        // we collect in the allsubject array

        let req = store.openCursor();


        req.onsuccess = function(event) {
            let cursor = event.target.result;
            if (cursor != null) {
                var cart_style_div = document.getElementById(cursor.key);
                cart_style_div.classList.add("active123");
            } else {

            }
        }
        req.onerror = function(event) {
            alert('error in cursor request ' + event.target.errorCode);
        }
    }

    function userBasket(subject_id,subject_name,price,discounted_price,subject_photo,university,university_name,regulation,branch_id,semester_id,$flag,$this) {
        let user_id = getCookie("user_id");

        $this.classList.toggle("active123");
        let tx = db.transaction(['user_basket'], 'readwrite')
        let store = tx.objectStore('user_basket');
        var key = subject_id+"_"+$flag

        let note = {user_id:user_id, subject_id:subject_id, subject_name:subject_name, price:price, discounted_price:discounted_price, subject_photo:subject_photo, university:university, university_name:university_name, regulation:regulation, branch_id:branch_id, semester_id:semester_id, flag:$flag};

        if($this.classList.contains("active123")){
            console.log('stored note!cc');
            store.put(note,key);
        }else{
            console.log('stored note!dd');
            store.delete(key);
        }
        tx.oncomplete = function() {
            console.log('stored note!');
        }
        tx.onerror = function(event) {
            alert('error storing note ' + event.target.errorCode);
        }





        // let tx = db.transaction(['user_basket'], 'readonly');
        // let store = tx.objectStore('user_basket');
        //
        // var keyRangeValue;
        // keyRangeValue = IDBKeyRange.only($subject_id+"_"+$flag);
        //
        // let req = store.openCursor(keyRangeValue);
        // let allsubject = [];
        //
        // $this.classList.toggle("active123");
        //
        // req.onsuccess = function(event) {
        //     let cursor = event.target.result;
        //     var a = 0;
        //     if (cursor != null) {
        //       allsubject.push(cursor.value);
        //     } else {
        //
        //         let tx1 = db.transaction(['user_basket'], 'readwrite');
        //         let store1 = tx1.objectStore('user_basket');
        //         let req = store.openCursor();
        //         let allusers = [];
        //         var key1 = $subject_id+"_"+$flag;
        //         var countRequest = store1.count(key1);
        //         countRequest.onsuccess = function() {
        //           console.log(countRequest.result);
        //           if(countRequest.result>0){
        //
        //
        //
        //
        //               let tx = db.transaction(['user_basket'], 'readwrite');
        //                 let store = tx.objectStore('user_basket');
        //                 let note = {user_id:user_id, subject_id:$subject_id, flag:$flag};
        //                 var key = $subject_id+"_"+$flag;
        //                 console.log('sathisss fixxxxx!'+allsubject.length);
        //                   store.delete(key);
        //               tx.oncomplete = function() {
        //                 console.log('stored note!');
        //               }
        //               tx.onerror = function(event) {
        //                 alert('error storing note ' + event.target.errorCode);
        //               }
        //
        //
        //
        //
        //
        //
        //             }else{
        //
        //
        //
        //               let tx = db.transaction(['user_basket'], 'readwrite');
        //         let store = tx.objectStore('user_basket');
        //         let note = {user_id:user_id, subject_id:$subject_id, flag:$flag};
        //         var key = $subject_id+"_"+$flag;
        //         console.log('sathisss fixxxxx!'+allsubject.length);
        //           console.log('insertttttttttt!'+a);
        //           store.put(note,key);
        //       tx.oncomplete = function() {
        //         console.log('stored note!');
        //       }
        //       tx.onerror = function(event) {
        //         alert('error storing note ' + event.target.errorCode);
        //       }
        //
        //
        //
        //
        //
        //             }
        //         }
        //     }
        // }
        // req.onerror = function(event) {
        //     alert('error in cursor request ' + event.target.errorCode);
        // }
    }

    function insertSubjects($result,$subCmd){
    	console.log("insertSubjects-44444444444444444--"+$subCmd);
        var result = $result;
			// console.log($result);
        // console.log("00000000000");
        // console.log(result);
        var j =0;


        let tx = db.transaction(['subject'], 'readwrite');
        let store = tx.objectStore('subject');
        // Put the sticky note into the object store

        data = result.data
        var data_length = data.length
        for (i=0;i<data_length;i++) {
            var branch_id = data[i].branch_id;//decode json
            var complete_notes = data[i].complete_notes;//decode json
            var date = data[i].date;//decode json
            var discounted_price = data[i].discounted_price;//decode json
            var flag = data[i].flag;//decode json
            var num_of_unit = data[i].num_of_unit;//decode json
            var price = data[i].price;//decode json
            var priority = data[i].priority;//decode json
            var regulation = data[i].regulation;//decode json
            var semester_id = $subCmd;//data[i].semester_id;//decode json
            var specialization = data[i].specialization;//decode json
            var subject_description = data[i].subject_description;//decode json
            var subject_id = data[i].subject_id;//decode json
            var subject_name = data[i].subject_name;//decode json
            var subject_photo = data[i].subject_photo;//decode json
            var tags = data[i].tags;//decode json
            var avg_rating = data[i].avg_rating;//decode json
            var new_subject_photo = data[i].new_subject_photo;//decode json
            var rating_count = data[i].rating_count;//decode json
            var single_line_content = data[i].single_line_content;//decode json
            var subject_points = data[i].subject_points;//decode json
            var subject_time = data[i].subject_time;//decode json
            var unit1 = data[i].unit1;//decode json
            var unit1_name = data[i].unit1_name;//decode json
            var unit2 = data[i].unit2;//decode json
            var unit2_name = data[i].unit2_name;//decode json
            var unit3 = data[i].unit3;//decode json
            var unit3_name = data[i].unit3_name;//decode json
            var unit4 = data[i].unit4;//decode json
            var unit4_name = data[i].unit4_name;//decode json
            var unit5 = data[i].unit5;//decode json
            var unit5_name = data[i].unit5_name;//decode json
            var unit6 = data[i].unit6;//decode json
            var unit6_name = data[i].unit6_name;//decode json
            var unit7 = data[i].unit7;//decode json
            var unit7_name = data[i].unit7_name;//decode json
            var unit8 = data[i].unit8;//decode json
            var unit8_name = data[i].unit8_name;//decode json
            var unit9 = data[i].unit9;//decode json
            var unit9_name = data[i].unit9_name;//decode json
            var unit10 = data[i].unit10;//decode json
            var unit10_name = data[i].unit10_name;//decode json
            var university_id = data[i].university_id;//decode json
            var year_id=getCookie("semester_id");


            let note = {branch_id:branch_id, complete_notes:complete_notes, date:date, discounted_price:discounted_price, flag:flag, num_of_unit:num_of_unit, price:price, priority:priority, regulation:regulation,semester_id:$subCmd,year_id:year_id, specialization:specialization, subject_description:subject_description, subject_id:subject_id, subject_name:subject_name, subject_photo:subject_photo, tags:tags, avg_rating:avg_rating, new_subject_photo:new_subject_photo, rating_count:rating_count, single_line_content:single_line_content, subject_points:subject_points, subject_time:subject_time, unit1:unit1, unit1_name:unit1_name, unit2:unit2, unit2_name:unit2_name, unit3:unit3, unit3_name:unit3_name, unit4:unit4, unit4_name:unit4_name, unit5:unit5, unit5_name:unit5_name, unit6:unit6, unit6_name:unit6_name, unit7:unit7, unit7_name:unit7_name, unit8:unit8, unit8_name:unit8_name, unit9:unit9, unit9_name:unit9_name, unit10:unit10, unit10_name:unit10_name, university_id:university_id};
            let key = semester_id+subject_id;
            store.put(note,key);

            // Wait for the database transaction to complete
            tx.oncomplete = function() {
                console.log('stored note!');
                if ($subCmd == 1) {
                    addSubject(1,0,0);
                    fetchSubject(2);
                } else if($subCmd == 2) {
                    // insert_version(result);
                    // console.log("adding in else condition");
                    addSubject(2,0,0);
                    // deleteSubjects();
                }
            }

            tx.onerror = function(event) {
                alert('error storing note ' + event.target.errorCode);
            }

                // var sql = "INSERT INTO subject(branch_id,complete_notes,date,discounted_price,flag,num_of_unit,price,priority,regulation,semester_id,year_id,specialization,subject_description,subject_id,subject_name,subject_photo,tags,avg_rating,new_subject_photo,rating_count,single_line_content,subject_points,subject_time,unit1,unit1_name,unit2,unit2_name,unit3,unit3_name,unit4,unit4_name,unit5,unit5_name,unit6,unit6_name,unit7,unit7_name,unit8,unit8_name,unit9,unit9_name,unit10,unit10_name,university_id) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";
                // transaction.executeSql(sql, [branch_id, complete_notes, date, discounted_price, flag, num_of_unit, price, priority, regulation,$subCmd,year_id, specialization, subject_description, subject_id, subject_name, subject_photo, tags, avg_rating, new_subject_photo, rating_count, single_line_content, subject_points, subject_time, unit1, unit1_name, unit2, unit2_name, unit3, unit3_name, unit4, unit4_name, unit5, unit5_name, unit6, unit6_name, unit7, unit7_name, unit8, unit8_name, unit9, unit9_name, unit10, unit10_name, university_id], function () {
                //     // console.log("condition----"+$subCmd+"------"+j);
                //     j++;
                //     if ($subCmd == 1 && j == (data_length)) {
                //         // // alert("adding in if condition");
                //         // deleteSubjects();
                //         addSubject(1,0,0);
                //         j=0;
                //         fetchSubject(2);//get subjects
                //         // console.log("adding in if condition");
                //
                //     } else if($subCmd == 2 && j == (data_length)) {
                //         // insert_version(result);
                //         // console.log("adding in else condition");
                //         addSubject(2,0,0);
                //         // deleteSubjects();
                //     }
                // }, function () {
                //     alert("error");
                // });
        }




        // db.transaction(function(transaction){
        //     var sql = "CREATE TABLE IF NOT EXISTS subject (branch_id VARCHAR(10) NOT NULL,complete_notes TEXT NOT NULL,date TEXT NOT NULL,discounted_price INTEGER NOT NULL,flag INTEGER NOT NULL,num_of_unit INTEGER NOT NULL,price INTEGER NOT NULL,priority INTEGER NOT NULL,regulation INTEGER NOT NULL,semester_id INTEGER NOT NULL,year_id INTEGER NULL,specialization INTEGER NOT NULL,subject_description TEXT NOT NULL,subject_id VARCHAR(255) NOT NULL,subject_name VARCHAR(255) NOT NULL,subject_photo VARCHAR(255) NOT NULL,tags TEXT NOT NULL,avg_rating VARCHAR(100) NOT NULL,rating_count VARCHAR(100) NOT NULL,single_line_content TEXT NOT NULL,subject_points VARCHAR(100) NOT NULL,new_subject_photo TEXT NOT NULL,subject_time VARCHAR(100) NOT NULL,unit1 TEXT NOT NULL,unit1_name TEXT NOT NULL,unit2 TEXT NOT NULL,unit2_name TEXT NOT NULL,unit3 TEXT NOT NULL,unit3_name TEXT NOT NULL,unit4 TEXT NOT NULL,unit4_name TEXT NOT NULL,unit5 TEXT NOT NULL,unit5_name TEXT NOT NULL,unit6 TEXT NOT NULL,unit6_name TEXT NOT NULL,unit7 TEXT NOT NULL,unit7_name TEXT NOT NULL,unit8 TEXT NOT NULL,unit8_name TEXT NOT NULL,unit9 TEXT NOT NULL,unit9_name TEXT NOT NULL,unit10 TEXT NOT NULL,unit10_name TEXT NOT NULL,university_id INT NOT NULL)";
        //     transaction.executeSql(sql,undefined,function(){
        //         db.transaction(function (transaction) {
        //         data = result.data
        //         var data_length = data.length
        //         for (i=0;i<data_length;i++) {
        //             var branch_id = data[i].branch_id;//decode json
        //             var complete_notes = data[i].complete_notes;//decode json
        //             var date = data[i].date;//decode json
        //             var discounted_price = data[i].discounted_price;//decode json
        //             var flag = data[i].flag;//decode json
        //             var num_of_unit = data[i].num_of_unit;//decode json
        //             var price = data[i].price;//decode json
        //             var priority = data[i].priority;//decode json
        //             var regulation = data[i].regulation;//decode json
        //             var semester_id = data[i].semester_id;//decode json
        //             var specialization = data[i].specialization;//decode json
        //             var subject_description = data[i].subject_description;//decode json
        //             var subject_id = data[i].subject_id;//decode json
        //             var subject_name = data[i].subject_name;//decode json
        //             var subject_photo = data[i].subject_photo;//decode json
        //             var tags = data[i].tags;//decode json
        //             var avg_rating = data[i].avg_rating;//decode json
        //             var new_subject_photo = data[i].new_subject_photo;//decode json
        //             var rating_count = data[i].rating_count;//decode json
        //             var single_line_content = data[i].single_line_content;//decode json
        //             var subject_points = data[i].subject_points;//decode json
        //             var subject_time = data[i].subject_time;//decode json
        //             var unit1 = data[i].unit1;//decode json
        //             var unit1_name = data[i].unit1_name;//decode json
        //             var unit2 = data[i].unit2;//decode json
        //             var unit2_name = data[i].unit2_name;//decode json
        //             var unit3 = data[i].unit3;//decode json
        //             var unit3_name = data[i].unit3_name;//decode json
        //             var unit4 = data[i].unit4;//decode json
        //             var unit4_name = data[i].unit4_name;//decode json
        //             var unit5 = data[i].unit5;//decode json
        //             var unit5_name = data[i].unit5_name;//decode json
        //             var unit6 = data[i].unit6;//decode json
        //             var unit6_name = data[i].unit6_name;//decode json
        //             var unit7 = data[i].unit7;//decode json
        //             var unit7_name = data[i].unit7_name;//decode json
        //             var unit8 = data[i].unit8;//decode json
        //             var unit8_name = data[i].unit8_name;//decode json
        //             var unit9 = data[i].unit9;//decode json
        //             var unit9_name = data[i].unit9_name;//decode json
        //             var unit10 = data[i].unit10;//decode json
        //             var unit10_name = data[i].unit10_name;//decode json
        //             var university_id = data[i].university_id;//decode json
        //            	var year_id=getCookie("semester_id");
        //
        //                 var sql = "INSERT INTO subject(branch_id,complete_notes,date,discounted_price,flag,num_of_unit,price,priority,regulation,semester_id,year_id,specialization,subject_description,subject_id,subject_name,subject_photo,tags,avg_rating,new_subject_photo,rating_count,single_line_content,subject_points,subject_time,unit1,unit1_name,unit2,unit2_name,unit3,unit3_name,unit4,unit4_name,unit5,unit5_name,unit6,unit6_name,unit7,unit7_name,unit8,unit8_name,unit9,unit9_name,unit10,unit10_name,university_id) VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)";
        //                 transaction.executeSql(sql, [branch_id, complete_notes, date, discounted_price, flag, num_of_unit, price, priority, regulation,$subCmd,year_id, specialization, subject_description, subject_id, subject_name, subject_photo, tags, avg_rating, new_subject_photo, rating_count, single_line_content, subject_points, subject_time, unit1, unit1_name, unit2, unit2_name, unit3, unit3_name, unit4, unit4_name, unit5, unit5_name, unit6, unit6_name, unit7, unit7_name, unit8, unit8_name, unit9, unit9_name, unit10, unit10_name, university_id], function () {
        //                     // console.log("condition----"+$subCmd+"------"+j);
        //                     j++;
        //                     if ($subCmd == 1 && j == (data_length)) {
        //                         // // alert("adding in if condition");
        //                         // deleteSubjects();
        //                         addSubject(1,0,0);
        //                         j=0;
        //                         fetchSubject(2);//get subjects
        //                         // console.log("adding in if condition");
        //
        //                     } else if($subCmd == 2 && j == (data_length)) {
        //                         // insert_version(result);
        //                         // console.log("adding in else condition");
        //                         addSubject(2,0,0);
        //                         // deleteSubjects();
        //                     }
        //                 }, function () {
        //                     alert("error");
        //                 });
        //                 }
        //             });
        //     },function(){});
        // });
    }

    function fetchSubject($subsem){
        // console.log("fetchSubject-666666666666666666");
        var branch_id=getCookie("branch_id");
        var year_id=getCookie("semester_id");
        if(branch_id == null || year_id == null){
            // showpopup()
            return;
        }
        var subsem = 1;
        if($subsem == 2){
            subsem = 2;
            // updateVersionToDb();
        }

        var data = {
            cmd: 103,
            branch_id:branch_id,//insert branch id
            year_id:year_id,//insert year id
            sub_sem_id:subsem,//sub sem id = 1 means 1st sem 2 = 2nd sem
            university_name :"JNTUK"
        }

        sendRequest(data,103,subsem,0);//get subjects
    }

    function addSubject($subsem,$cmdFrom,$subject_id){
    	console.log("addSubjecttohomepage-5555555555555555"+$subject_id);
    	var year_id=getCookie("semester_id");
    	var branch_id=getCookie("branch_id");
    	var queryText = "";
        var div_to_append = "";
        let dataForSearch = "";
    	if(year_id == 1){//delete later
    		branch_id = 0;
    	}


    	let tx = db.transaction(['subject'], 'readonly');
        let store = tx.objectStore('subject');
        // Create a cursor request to get all items in the store, which
        // we collect in the allsubject array
        var keyRangeValue;
        if($subject_id != 0){
            keyRangeValue = IDBKeyRange.only($subject_id);
        }else if($subsem == 1){
            keyRangeValue = IDBKeyRange.bound("1", "2");
        }else if($cmdFrom == 10){
            keyRangeValue = "";
        }else{
            keyRangeValue = IDBKeyRange.bound("2", "3");
        }

        let req = store.openCursor(keyRangeValue);
        let allsubject = [];

        req.onsuccess = function(event) {
            let cursor = event.target.result;
            if (cursor != null) {
                console.log(cursor.value);
              allsubject.push(cursor.value);
              cursor.continue();
            } else {
              // displaysubject(allsubject);
                console.log("$subsem"+$subsem+"$cmdFrom"+$cmdFrom+"$subject_id"+$subject_id+"allsubject"+allsubject);
                displaySubjects($subsem,$cmdFrom,$subject_id,allsubject);
            }
        }
        req.onerror = function(event) {
            alert('error in cursor request ' + event.target.errorCode);
        }

		}

    function displaySubjects($subsem,$cmdFrom,$subject_id,subject){
        console.log("sub:"+$subsem+"--cmdfrom:"+$cmdFrom+" subject_id:"+$subject_id+" subject:"+subject);
        var total_mobile_content = "";
        for (let i = 0; i < subject.length; i++) {

            var each_subject = JSON.stringify(subject[i]);
            var subjectJsonObj = JSON.parse(each_subject);
            console.log(subjectJsonObj['subject_name']);
            var row = subjectJsonObj;
            var div_to_append = "";
            var div_to_append_mobile = "";


            if($subject_id != 0){
                // queryText = "WHERE subject_id = '"+$subject_id+"'";
            }else if($cmdFrom == 10){
                // queryText = "";
            }else if($subsem == 1){
                div_to_append = document.getElementById("homepage_subjects");
                div_to_append_mobile = document.getElementById("homepage_subjects_mobile");
                // queryText = "WHERE semester_id = '1' AND year_id = '"+year_id+"' AND branch_id = '"+branch_id+"' ORDER BY flag DESC";
            }else{
                div_to_append = document.getElementById("homepage_subjects1");
                // div_to_append_mobile = document.getElementById("homepage_subjects_mobile1");
                // queryText = "WHERE semester_id = '2' AND year_id = '"+year_id+"' AND branch_id = '"+branch_id+"' ORDER BY flag DESC";
            }

            var branch_id = row['branch_id'];//decode json
            var complete_notes = row['complete_notes'];//decode json
            var date = row['date'];//decode json
            var discounted_price = row['discounted_price'];//decode json
            var flag = row['flag'];//decode json
            var num_of_unit = row['num_of_unit'];//decode json
            var price = row['price'];//decode json
            var priority = row['priority'];//decode json
            var regulation = row['regulation'];//decode json
            var semester_id = row['semester_id'];//decode json
            var specialization = row['specialization'];//decode json
            var subject_description = row['subject_description'];//decode json
            var subject_id = row['subject_id'];//decode json
            var subject_name = row['subject_name'];//decode json
            var subject_photo = row['subject_photo'];//decode json
            var tags = row['tags'];//decode json
            var avg_rating = row['avg_rating'];//decode json
            var new_subject_photo = row['new_subject_photo'];//decode json
            var rating_count = row['rating_count'];//decode json
            var single_line_content = row['single_line_content'];//decode json
            var subject_points = row['subject_points'];//decode json
            var subject_time = row['subject_time'];//decode json
            var unit1 = row['unit1'];//decode json
            var unit1_name = row['unit1_name'];//decode json
            var unit2 = row['unit2'];//decode json
            var unit2_name = row['unit2_name'];//decode json
            var unit3 = row['unit3'];//decode json
            var unit3_name = row['unit3_name'];//decode json
            var unit4 = row['unit4'];//decode json
            var unit4_name = row['unit4_name'];//decode json
            var unit5 = row['unit5'];//decode json
            var unit5_name = row['unit5_name'];//decode json
            var unit6 = row['unit6'];//decode json
            var unit6_name = row['unit6_name'];//decode json
            var unit7 = row['unit7'];//decode json
            var unit7_name = row['unit7_name'];//decode json
            var unit8 = row['unit8'];//decode json
            var unit8_name = row['unit8_name'];//decode json
            var unit9 = row['unit9'];//decode json
            var unit9_name = row['unit9_name'];//decode json
            var unit10 = row['unit10'];//decode json
            var unit10_name = row['unit10_name'];//decode json
            var university_id = row['university_id'];//decode json
            var university_name = "JNTUK";

            if($subject_id !=0){
                var top_buynow_button = document.getElementById("top_buynow_button");
                var syllabus_units = document.getElementById("syllabus_units");
                var subject_details_title_down = document.getElementById("subject_details_title_down");
                var notes_pdf = document.getElementById("notes_pdf");
                var purchase_status = getCookie("purchase_status");
                console.log("purchase_status_in subject"+purchase_status);

                if(purchase_status == "false" || purchase_status == false){
                    console.log("purchase_status_in subject1"+purchase_status);
                    if(url_page == "mobile_video_view"){
                        top_buynow_button.innerHTML = "<button class=\"btn btn-success\" id=\"add_to_cart_btn\" type=\"submit\" style=\"background: #00b0f0; box-shadow: none; padding: 9px; margin: auto; width: 90%; color: white; font-size: 13px; border: 0px; font-family: Retina,Arial,Helvetica,sans-serif; font-weight: 800;\" onclick=\"\" >Buy Now : &#x20B9;"+discounted_price+"</button> ";
                    }else{
                        top_buynow_button.innerHTML = "<div style=\"background: #4593e3;\" class=\"col-md-12\"><form method=\"POST\" action=\"\" style=\"margin:;text-align:right; ;\" ><input type=\"hidden\" class=\"form-control\" name=\"university_id\" value=\" \" > <input type=\"hidden\" class=\"form-control\" name=\"semester_id\" value=\" \" > <input type=\"hidden\" class=\"form-control\" name=\"branch_id\" value=\" \" > <input type=\"hidden\" class=\"form-control\" name=\"subject_id\" value=\" \" > <input type=\"hidden\" class=\"form-control\" name=\"regulation\" value=\" \" > <h1 style=\"font-family: 'Inconsolata', monospace; font-weight: 900; font-size: 18px; margin: 0; display: inline-block; max-width: 74%; color: #ffffff; text-shadow: 0 0 2px #000;vertical-align:middle;\">Purchase Complete "+subject_name+" Course For Just &#x20B9;"+discounted_price+" <strike style=\"font-size:0.7em;\">"+price+"</strike></h1> <button class=\"btn btn-success\" id=\"add_to_cart_btn\" type=\"submit\" style=\"margin: 21px; background: #216fbd; box-shadow: none; font-family: 'Inconsolata', monospace; font-weight: 900;\" name=\"add_to_cart\" >Buy Now: &#x20B9;"+discounted_price+"</button> </form> </div>";
                    }
                }else{
                    console.log("purchase_status_in subject2"+purchase_status);
                }
                // for (k= 0;k<10;k++)
                var unit_heaading = [];
                var unit_boody = [];

                unit_heaading[0] = unit1_name;
                unit_boody[0] = unit1;

                unit_heaading[1] = unit2_name;
                unit_boody[1] = unit2;

                unit_heaading[2] = unit3_name;
                unit_boody[2] = unit3;

                unit_heaading[3] = unit4_name;
                unit_boody[3] = unit4;

                unit_heaading[4] = unit5_name;
                unit_boody[4] = unit5;

                unit_heaading[5] = unit6_name;
                unit_boody[5] = unit6;

                unit_heaading[6] = unit7_name;
                unit_boody[6] = unit7;

                unit_heaading[7] = unit8_name;
                unit_boody[7] = unit8;

                unit_heaading[8] = unit9_name;
                unit_boody[8] = unit9;

                unit_heaading[9] = unit10_name;
                unit_boody[9] = unit10;
                syllabus_units.innerHTML = "";


                for (j=0;j<10;j++){
                    if(unit_boody[j]){
                        var unit_heading = unit_heaading[j];
                        var unit_body = unit_boody[j];
                        // console.log(unit_heaading[j]+"---"+unit_boody[j]);
                        syllabus_units.innerHTML +=
                        "<a href=\"#\" class=\"togglefaq\" onclick=\"syllabusDropdown(this)\" style=\"text-decoration:none\"><b>" +
                        "UNIT-"+(j+1)+": "+unit_heading+
                        "</b> <i class=\"fa fa-angle-down pull-right\" style=\"font-size:26px\"></i> </a> <div class=\"faqanswer\" style=\"width: 107%;margin-left: -14px;\"> <p>"+
                        unit_body+
                        " </p> </div> "
                    }
                }
                if(url_page == "mobile_video_view"){
                    subject_details_title_down.innerHTML = ""+university_name+"&nbsp; &gt;&gt; &nbsp; "+regulation+"&nbsp; &gt;&gt; &nbsp; "+getCookie("branch_name")+"&nbsp; &gt;&gt; &nbsp; "+getCookie("year_name")+"&nbsp; &gt;&gt; &nbsp; "+subject_name+"";
                }else{
                    subject_details_title_down.innerHTML = "<p dir=\"auto\" itemprop=\"description\"> "+university_name+"&nbsp; &gt;&gt; &nbsp; "+regulation+" &nbsp; &gt;&gt; &nbsp; "+branch_id+" &nbsp; &gt;&gt; &nbsp; Semester-"+semester_id+" &nbsp; &gt;&gt; &nbsp; "+subject_name+" </p>";
                }
                if(purchase_status == "false"){
                    if(url_page == "mobile_video_view"){
                        notes_pdf.innerHTML = "<style>.watch-video-show-more.desc.pt_mn_wtch_rdmre{display:none!important;}</style><div class=\"col-md-12\" style=\"padding-top: 8px;\"> <h1 style=\"font-family: Retina,Arial,Helvetica,sans-serif;font-size: 14px;line-height: 25px;font-weight: 700;color: rgb(83 82 82 / 80%);\">To Get Complete Notes and video Lessons Purchase complete "+subject_name+" Course For Just &#x20B9;"+discounted_price+" <strike style=\"font-size:0.7em;\">"+price+"</strike></h1> <button class=\"btn btn-success\" id=\"add_to_cart_btn\" type=\"submit\" style=\"margin: 9px;background: #216fbd;box-shadow: none;padding: 9px; width: 90%;color: white;font-size: 11px;border: 0px;font-family: Retina,Arial,Helvetica,sans-serif;font-weight: 800;\" >Buy Now: &#x20B9;"+discounted_price+"</button><br> <button class=\"btn btn-success\" id=\"add_to_cart_btn\" type=\"submit\" style=\"margin: 9px;background: #216fbd;box-shadow: none;padding: 9px; width: 90%;color: white;font-size: 11px;border: 0px;font-family: Retina,Arial,Helvetica,sans-serif;font-weight: 800;\" >Buy Complete Semester: &#x20B9;"+discounted_price+"</button> </div>";
                    }else{
                        notes_pdf.innerHTML = "<style>.watch-video-show-more.desc.pt_mn_wtch_rdmre{display:none}</style> <h1 style=\"font-family: Retina,Arial,Helvetica,sans-serif;font-size: 14px;line-height: 25px;font-weight: 700;color: rgb(83 82 82 / 80%);\">To Get Complete Notes and video Lessons Purchase complete "+subject_name+" Course For Just &#x20B9;"+discounted_price+" <strike style=\"font-size:0.7em;\">"+price+"</strike></h1> <button class=\"btn btn-success\" id=\"add_to_cart_btn\" type=\"submit\" style=\"margin: 9px;background: #216fbd;box-shadow: none;padding: 9px; width: 40%;color: white;font-size: 11px;border: 0px;font-family: Retina,Arial,Helvetica,sans-serif;font-weight: 800;\" name=\"add_to_cart\" onclick=\"\">Buy Now: &#x20B9;"+discounted_price+"</button><button class=\"btn btn-success\" id=\"add_to_cart_btn\" type=\"submit\" style=\"margin: 9px;background: #216fbd;box-shadow: none;padding: 9px; width: 40%;color: white;font-size: 11px;border: 0px;font-family: Retina,Arial,Helvetica,sans-serif;font-weight: 800;\" name=\"add_to_cart\" onclick=\"\">Buy Complete Semester: &#x20B9;"+discounted_price+"</button>";
                    }
                }
            }else if($cmdFrom == 10){

                dataForSearch += '{\"responseData\": {\"results\" : [{\"url\": \"nv pettoko\",\"titleNoFormatting\": \"'+subject_name+'\",\"content\": \"'+subject_description+'\"},]}}';
            }else{
                var link = "";
                var display_cart = ""
                if(flag != 2){
                    discounted_price = "Coming Soon";
                    link = "?url=coming_soon";
                    display_cart = "none";

                }else{
                    link = "?url=video_view&subject_id="+subject_id+"&semester_id="+$subsem;

                }

                var cart_id = subject_id+"_1";
                var wishlist_id = subject_id+"_2";


                div_to_append.innerHTML += "<style>"+"#"+cart_id+"{display: "+display_cart+"}</style><div class=\"item hover-container desktop_view\" style=\"padding-bottom: 40px;max-width: 280.2px!important;\"> <div class=\"carousel--container--22Ab7 hover-target\"> <div id=\"course-unit-container-Python\" aria-live=\"polite\" class=\"\"> <div data-index=\"1\" class=\"carousel--scroll-item--3Wciz \" > <div> <div class=\"popper--popper--19faV popper--popper-hover--4YJ5J \"> <a id=\" u626-popper-trigger--30\" tabindex=\"0\" aria-expanded=\"false\" href=\""+link+"\" class=\"hover-target udlite-custom-focus-visible browse-course-card--link--3KIkQ\" style=\"display: block;color:black;text-decoration: none;\"> <div data-purpose=\"container\" class=\"\"> <div class=\"course-card--image-wrapper--Sxd90\"> <img alt=\"\" width=\"240\" height=\"135\" class=\"course-card--course-image--2sjYP browse-course-card--image--35hYN\" src=\"https://veteachwebfiles.s3.ap-south-1.amazonaws.com/assets/uploads/"+subject_photo+"\"> </div> <div class=\"course-card--main-content--3xEIw course-card--has-price-text--1Ikr0\"> <div class=\"udlite-focus-visible-target udlite-heading-md course-card--course-title--2f7tE\">"+subject_name+"</div> <div class=\"udlite-text-xs course-card--instructor-list--lIA4f\" data-purpose=\"safely-set-inner-html:course-card:visible-instructors\">"+subject_description+"</div> <div class=\"course-card--row--1OMjg\"> <span class=\"star-rating--star-wrapper--2eczq\"> <span class=\"udlite-sr-only\">Rating: 4.5 out of 5</span><span class=\"udlite-heading-sm star-rating--rating-number--3lVe8\" aria-hidden=\"true\" data-purpose=\"rating-number\">4.5</span> <span class=\"checked_star fa fa-star\"></span><span class=\"checked_star fa fa-star\"></span> <span class=\"checked_star fa fa-star\"></span> <span class=\"checked_star fa fa-star\"></span> <span class=\"checked_star fa fa-star\"></span> <span class=\"checked_star fa fa-star-0\"></span> </span> <span aria-label=\"139919 reviews\" class=\"udlite-text-xs course-card--reviews-text--12UpL\">(519)</span> </div> </a><div class=\"price-text--container--Ws-fP course-card--price-text-container--2sb8G\" data-purpose=\"price-text-container\"> <div class=\"price-text--price-part--Tu6MH course-card--discount-price--3TaBk udlite-heading-md\" data-purpose=\"course-price-text\"><span class=\"udlite-sr-only\">Current price</span><span><span>&#x20b9;"+discounted_price+"</span></span></div> <span style=\"margin-left: 46px;\"><button style=\"border: none;\" type=\"button\" class=\"wishlist-btn \" title=\"Add to Cart\"  id=\"21\" tabindex=\"0\"><i class=\"fa fa-shopping-cart\" id=\""+cart_id+"\" onclick=\"userBasket('"+subject_id+"','"+subject_name+"','"+price+"','"+discounted_price+"','"+subject_photo+"','"+university_id+"','"+university_name+"','"+regulation+"','"+branch_id+"','"+semester_id+"',1,this)\"></i></button> <button style=\"border: none;padding-left:10px;\" type=\"button\" class=\"wishlist-btn \" title=\"Add to wishlist\"  id=\"21\" tabindex=\"0\"><i class=\"fa fa-heart\" id=\""+wishlist_id+"\" onclick=\"userBasket('"+subject_id+"','"+subject_name+"','"+price+"','"+discounted_price+"','"+subject_photo+"','"+university_id+"','"+university_name+"','"+regulation+"','"+branch_id+"','"+semester_id+"',2,this)\"></i></button></span></div> <div class=\"udlite-badge udlite-heading-xs udlite-badge-bestseller \">Bestseller</div> </div> </div> </div> </div> </div> </div> </div> <aside class=\"hover-popup animate__fadeIn\"> <div class=\"course-popover-content\"> <div class=\"course-title\"> <a href=\"#\" tabindex=\"0\">"+subject_name+"</a> </div> <div class=\"last-updated\">Last updater "+date+"</div> <div class=\"course-meta\" style=\"color: #f6892a;\"> <span class=\"\"><i class=\"fa fa-play-circle\" aria-hidden=\"true\"></i> 10 Lessons </span> <span class=\"\"><i class=\"fa fa-clock-o\" aria-hidden=\"true\"></i> 11:33:48 Hours </span> <span class=\"\"><i class=\"fa fa-closed-captioning\" aria-hidden=\"true\"></i></span> </div> <div class=\"course-subtitle\">"+subject_description+"</div> <div class=\"what-will-learn\"> <ul> <li style=\"display: block!important; display: -webkit-box!important; -webkit-line-clamp: 3; -moz-line-clamp: 3; -ms-line-clamp: 3; -o-line-clamp: 3; line-clamp: 3; -webkit-box-orient: vertical; -moz-box-orient: vertical; -ms-box-orient: vertical; -o-box-orient: vertical; box-orient: vertical; overflow: hidden; text-overflow: ellipsis; white-space: normal; visibility: visible; font-size: 15px; line-height: 1.53; letter-spacing: -.2px; color: #686f7a; padding-top: 10px;\"><i class=\"fa fa-check\" aria-hidden=\"true\" style=\"color: #828282; padding-right: 10px; font-size: 14px; font-weight: 100;\"></i>"+subject_description+"</li> </ul> </div> <div class=\"popover-btns\" style=\"padding-right: 0px;\"> <button type=\"button\" class=\"btn add-to-cart-btn big-cart-button-21\" id=\"21\" tabindex=\"0\" style=\"color: #fff; background-color: #f6892a; border-color: #f6892a; padding: 11px 12px; font-size: 15px;border-radius: 2px; line-height: 1.35135; font-weight: 600;\"> Buy Now </button><br><br> <button type=\"button\" class=\"btn add-to-cart-btn big-cart-button-21\" id=\"21\" onclick=\"handleCartItems(this)\" tabindex=\"0\" style=\"color: #fff; background-color: #f6892a; border-color: #f6892a; padding: 11px 12px; font-size: 15px; border-radius: 2px; line-height: 1.35135; font-weight: 600;\"> Buy Complete Semester </button></div></div></aside></div>";

                var top_text = "";
                var body_text = " <a id=\"u626-popper-trigger--30\" tabindex=\"0\" aria-expanded=\"false\" href=\""+link+"\" class=\"hover-target udlite-custom-focus-visible browse-course-card--link--3KIkQ\" style=\"display: block;text-decoration: none;\"> <div class=\"col-md-12\"> <div class=\"row\"> <div class=\"col-md-4 col-xs-4 col-sm-4\" style=\"top: -15px;padding-left: 7px; padding-right: 7px;\"><img src=\"https://veteachwebfiles.s3.ap-south-1.amazonaws.com/assets/uploads/"+subject_photo+"\" style=\"height: 61px;\"></div> <div class=\"col-md-8 col-xs-8 col-sm-8\" style=\"text-align:left;padding-left: 0px; padding-right: 0px;\" > <div class=\"udlite-focus-visible-target udlite-heading-md course-card--course-title--2f7tE\" style=\"font-size: 14px; line-height: 20px;\">"+subject_name+"</div> <div class=\"udlite-text-xs course-card--instructor-list--lIA4f\" data-purpose=\"safely-set-inner-html:course-card:visible-instructors\">"+subject_description+"</div> <div class=\"course-card--row--1OMjg\"> <span class=\"star-rating--star-wrapper--2eczq\"> <span class=\"udlite-sr-only\">Rating: 4.5 out of 5</span><span class=\"udlite-heading-sm star-rating--rating-number--3lVe8\" aria-hidden=\"true\" data-purpose=\"rating-number\">4.5</span> <span class=\"checked_star fa fa-star\" style=\"font-size: 13px;\"></span> <span class=\"checked_star fa fa-star\" style=\"font-size: 13px;\"></span><span class=\"checked_star fa fa-star\" style=\"font-size: 13px;\"></span> <span class=\"checked_star fa fa-star\" style=\"font-size: 13px;\"></span> <span class=\"checked_star fa fa-star\" style=\"font-size: 13px;\"></span> <span class=\"checked_star fa fa-star-0\" style=\"font-size: 13px;\"></span> <span aria-label=\"139919 reviews\" class=\"udlite-text-xs course-card--reviews-text--12UpL\">(455)</span> </span></div><div class=\"price-text--container--Ws-fP course-card--price-text-container--2sb8G\" data-purpose=\"price-text-container\"> <div class=\"price-text--price-part--Tu6MH course-card--discount-price--3TaBk udlite-heading-md\" data-purpose=\"course-price-text\"><span class=\"udlite-sr-only\">Current price</span><span><span style=\"font-size: 13px;\">"+discounted_price+"</span></span> <strike style=\"font-size: 10px;\">"+price+"</strike> </div> </div> <div class=\"udlite-badge udlite-heading-xs udlite-badge-bestseller \" style=\"font-size: 13px;\">Bestseller</div> </div></div> </div> </a><br>";
                var bottom_text = "";
                if(i%3 == 0){
                    top_text = "<div class=\"item mobile_view\" style=\"padding-bottom: 40px;width: 241.2px!important;\"><div class=\"col-md-12 col-xs-12 col-sm-12\" style=\"padding-left: 0px; padding-right: 0px;\">";
                }else if(i%3 == 2){
                    bottom_text = "</div> </div>";
                }
                total_mobile_content += top_text+body_text+bottom_text;
                console.log($cmdFrom+"--"+i+"--"+(subject.length-1));
                if($cmdFrom == 1 && i == subject.length-1){
                    addSubject(2,0,0);
                }
                if(i == subject.length-1){

                    div_to_append.innerHTML += total_mobile_content;
                }
                ResCarouselSize();
            }

    	        if($cmdFrom == 10){
                    // alert(dataForSearch);
                }
        }


        if($subject_id != 0){
            }else if($cmdFrom == 10){
            }else if($subsem == 1){
            }else{
            addUserBasketStyle();
        }
    }

    function addUserBasketStyle() {
        let tx = db.transaction(['user_basket'], 'readonly');
        let store = tx.objectStore('user_basket');
        // Create a cursor request to get all items in the store, which
        // we collect in the allsubject array

        let req = store.openCursor();


        req.onsuccess = function(event) {
            let cursor = event.target.result;
            if (cursor != null) {

                var key = "'"+cursor.key+"'";
                console.log(key+" -- key");
                var cart_style_div = document.getElementById(cursor.key);
                cart_style_div.classList.add("active123");
            } else {

            }
        }
        req.onerror = function(event) {
            alert('error in cursor request ' + event.target.errorCode);
        }
    }

    function insertVideo($result){
        console.log($result);
        var result = $result;
        var notes = [];
        var subject_id = "";
        var data = result.data;
        var key = data[0].subject_id;
        let tx = db.transaction(['video'], 'readwrite');
        let store = tx.objectStore('video');
        var each_subject = JSON.stringify(data);
        console.log('stored note!'+key+each_subject);
        store.put(each_subject,key);
        tx.oncomplete = function() {
            addVideos();
        }

        tx.onerror = function(event) {
            alert('error storing note ' + event.target.errorCode);
        }


        // Put the sticky note into the object store

        // data = result.data
        // var data_length = data.length
        // for (i=0;i<data_length;i++) {
        //     var datentime = data[i].datentime;//decode json
        //     var full_video = data[i].full_video;//decode json
        //     var part_num = data[i].part_num;//decode json
        //     subject_id = data[i].subject_id;//decode json
        //     var tags = data[i].tags;//decode json
        //     var trail_video = data[i].trail_video;//decode json
        //     var unit_num = data[i].unit_num;//decode json
        //     var video_active = data[i].video_active;//decode json
        //     var video_description = data[i].video_description;//decode json
        //     var video_file = data[i].video_file;//decode json
        //     var video_id = data[i].video_id;//decode json
        //     var video_name = data[i].video_name;//decode json
        //     var video_photo = data[i].video_photo;//decode json
        //     var view_count = data[i].view_count;//decode json
        //
        //     let tx = db.transaction(['video'], 'readwrite');
        //     let store = tx.objectStore('video');
        //     let note = {datentime:datentime, full_video:full_video, part_num:part_num, subject_id:subject_id, tags:tags, trail_video:trail_video, unit_num:unit_num, video_active:video_active, video_description:video_description,video_file:video_file,video_id:video_id, video_name:video_name, video_photo:video_photo, view_count:view_count};
        //     notes.push(note);
        //
        //     // Wait for the database transaction to complete
        //     tx.oncomplete = function() {
        //         let key = subject_id;
        //
        //
        //         // if ($subCmd == 1) {
        //         //     addSubject(1,0,0);
        //         //     fetchSubject(2);
        //         // } else if($subCmd == 2) {
        //         //     // insert_version(result);
        //         //     // console.log("adding in else condition");
        //         //     addSubject(2,0,0);
        //         //     // deleteSubjects();
        //         // }
        //         var each_subject = JSON.stringify(result);
        //         console.log('stored note!'+subject_id+each_subject);
        //         store.put(each_subject,key);
        //         // addFirstVideo();
        //     }
        //
        //     tx.onerror = function(event) {
        //         alert('error storing note ' + event.target.errorCode);
        //     }
        //
        // }
    }

    function addVideos(){
        let url_str = window.location.href;
        let window_url = new URL(url_str);
        let search_params = window_url.searchParams;
        let subject_id = search_params.get('subject_id');
        let video_id = search_params.get('video_id');
        let unit_id = search_params.get('unit_id');
        console.log("add video topics");
        var div_to_append = document.getElementById("unit_wise_videos");

        let tx = db.transaction(['video'], 'readonly');
        let store = tx.objectStore('video');
        // Create a cursor request to get all items in the store, which
        // we collect in the allsubject array
        var keyRangeValue = IDBKeyRange.only(subject_id);

        let req = store.openCursor(keyRangeValue);
        let allvideos = [];

        req.onsuccess = function(event) {
            // The result of req.onsuccess is an IDBCursor
            let cursor = event.target.result;
            if (cursor != null) {
              // If the cursor isn't null, we got an IndexedDB item.
              // Add it to the note array and have the cursor continue!
                console.log(cursor.value);
              allvideos.push(cursor.value);
              cursor.continue();
            } else {
              // If we have a null cursor, it means we've gotten
              // all the items in the store, so display the subject we got
              // displaysubject(allsubject);
                displayVideos(allvideos);
            }
        }
        req.onerror = function(event) {
            alert('error in cursor request ' + event.target.errorCode);
        }
    }

    function displayVideos(videos){
        let url_str = window.location.href;
        let window_url = new URL(url_str);
        let search_params = window_url.searchParams;
        let subject_id_url = search_params.get('subject_id');
        let video_id_url = search_params.get('video_id');
        let unit_id_url = search_params.get('unit_id');
        let semester_id = search_params.get('semester_id');

        if(videos.length == 0){
            fetchVideos(subject_id_url)
            return;
        }


        var each_videos = videos[0];
        var videoJsonObj = JSON.parse(each_videos);

        var video_main_details = document.getElementById("video_main_details");
        var iframe_video = document.getElementById("iframe_video");

        var div_to_append = document.getElementById("unit_wise_videos");
        var purchase_status = getCookie("purchase_status");
        console.log("purchase status:"+purchase_status);

        for (let i = 0; i < videoJsonObj.length; i++) {
            var row = videoJsonObj[i];
            console.log("what we got"+videoJsonObj.length);
            console.log(row);

            var div_to_append_mobile = "";

            var datentime = row['datentime'];//decode json
            var part_num = row['part_num'];//decode json
            var subject_id = row['subject_id'];//decode json
            var tags = row['tags'];//decode json

            var unit_num = row['unit_num'];//decode json
            var video_active = row['video_active'];//decode json
            var video_description = row['video_description'];//decode json
            var video_file = row['video_file'];//decode json
            var video_id = row['video_id'];//decode json
            var video_name = row['video_name'];//decode json
            var video_photo = row['video_photo'];//decode json
            var view_count = row['video_priority'];//decode json
            var trail_video_raw = row['trail_video'];//decode json
            var trail_video = trail_video_raw.substr(trail_video_raw.length-9);
            var full_video_raw = row['full_video'];//decode json
            var full_video = full_video_raw.substr(full_video_raw.length-9);

            if((part_num == 1 && unit_num == 1 && (typeof video_id_url === "undefined" || video_id_url == null)) || video_id_url == video_id){
                var video_url
                if(purchase_status == "false"){
                    video_url = trail_video;
                }else{
                    video_url = full_video;
                }



                if(url_page == "mobile_video_view"){
                    video_main_details.innerHTML = "<h1 class=\"text_style1\">"+video_name+"</h1> <p dir=\"auto\" itemprop=\"description\" style=\"font-size: 10px;font-weight: bold;\" id=\"subject_details_title_down\"> </p> <div class=\"col-md-12\" id=\"top_buynow_button\"> </div>";
                    iframe_video.innerHTML = "<div class=\"embed-container\" > <iframe src=\"https://player.vimeo.com/video/"+video_url+"\" frameborder=\"0\" webkitallowfullscreen=\"\" mozallowfullscreen=\"\" allowfullscreen=\"\" width=\"100%\"></iframe> </div>";
                }else{
                    video_main_details.innerHTML = "<div class=\"video-title pt_video_info\"> <input type=\"hidden\" value=\"35943\" id=\"video-id\"> <div class=\"video-big-title\"> <h1 itemprop=\"title\" style=\"text-transform:capitalize;\">"+video_name+" </h1> </div> <div class=\"video-views\"> <span id=\"video-views-count\">"+view_count+" </span> Views </div> <div class=\"video-views\"> <a href=\"https://web.whatsapp.com/send?text=https://veteach.in/courses/video_view.php?video_id="+video_id+"\" target=\"_blank\" style=\"position: unset;text-decoration:none;\" class=\"desktopwhatsapp\"><i class=\"fa fa-whatsapp\" aria-hidden=\"true\" style=\"font-size: 24px;color: #00b0f0;\"></i>&nbsp;Share&nbsp; </a> <a href= \"whatsapp://send?text=https://veteach.in/courses/video_view.php?video_id="+video_id+"\" data-action=\"share/whatsapp/share\" target=\"_blank\" style=\"position: unset;text-decoration:none;\" class=\"mobilewhatsapp\"><i class=\"fa fa-whatsapp\" aria-hidden=\"true\" style=\"font-size: 24px;color: #00b0f0;\"></i>&nbsp;Share&nbsp;</a> </div> <div class=\"video-views\"> <form id=\"fupForm\" name=\"form1\" method=\"post\" style=\"display: inline;vertical-align: top;\"> <input type=\"hidden\" class=\"form-control\" id=\"user_id\" name=\"user_id\" value=\"\" > <input type=\"hidden\" class=\"form-control\" id=\"video_id\" name=\"video_id\" value= > <i onclick=\"myFunctionHeart(this)\" class=\"safa fa \" name=\"save\" id=\"butsave\" style=\"font-size: 27px; cursor: pointer; user-select: none; color: #00b0f0;\"></i></form> <div id=\"success\"></div> </div> <div class=\"publisher-element pull-left pt_mn_wtch_pub\" style=\"display:none;\"> <div class=\"publisher-avatar pull-left hide-in-mobile-720\" style=\"display:none;\"> <a href=\"#\"></a> </div> <div class=\"publisher-name\" >  </div> <div class=\"clear\"></div> </div> <div class=\"clear\"></div> <div class=\"video-published\"> Published on "+datentime+" </div> <div class=\"watch-video-description\" id=\"subject_details_title_down\"> <!--<span class=\"post-views-label\">Rating</span>--> </div> <div> <style> .checked_star { color: orange; } </style> <h7 style=\"color: #be5a0e;font-weight:600;font-size: 17px;\">545</h7>&nbsp;<span class=\"checked_star fa fa-star\"></span> <span class=\"checked_star fa fa-star\"></span> <span class=\"checked_star fa fa-star\"></span> <span class=\"checked_star fa fa-star\"></span> <span class=\"checked_star fa fa-star\"></span> &nbsp; <h7 style=\"color: #73726c;\">4545</h7> <span style=\"color:green;\">Thank Your for your Review!</span> <a href=\"javascript:myRating();\">Review Now</a> </div> <div class=\"watch-video-show-more desc pt_mn_wtch_rdmre\">Note: For Better view of the pdf file Adjust it With Below Options & if you see a blank pdf file please click on auto adjust or adjust height/width</div> <hr> <span id=\"pdf_file\"></span> <hr> <div class=\"player-video\" style=\"margin: auto !important; float:unset;text-align:center;\"> <div style=\"padding-top: 28px;\" id=\"notes_pdf\"> </div> </div> </div>";
                    iframe_video.innerHTML = "<div class=\"video-player pt_video_player \" id=\"post_live_video_35943\"><div class='embed-container' ><iframe src=\"https://player.vimeo.com/video/"+video_url+"\" frameborder=\"0\" webkitallowfullscreen=\"\" mozallowfullscreen=\"\" allowfullscreen=\"\" width=\"100%\"></iframe></div><div class=\"icons hidden\"><span class=\"expend-player\"><i class=\"fa fa-expand fa-fw\"></i></span></div></div>";
                }

                addSubject(0,0,semester_id+subject_id);
                if(purchase_status == "true"){
                    var pdf_file = document.getElementById("pdf_file");
                    pdf_file.innerHTML = "<div class=\"pdf-container\" data-href=\"https://veteach.in/assets/uploads/video_file/"+video_file+"\"></div>";
                }
            }
            console.log("unit_id_url="+unit_id_url+"unit_num="+unit_num+"semester_id="+semester_id);
            if(typeof unit_id_url === "undefined" || unit_id_url == null || unit_id_url == 0){
                if(url_page == "mobile_video_view"){
                    var link = "?url=mobile_video_view&video_id="+video_id+"&semester_id="+semester_id+"&subject_id="+subject_id;
                    div_to_append.innerHTML += "<div class=\"col-md-12\" style=\"padding: 0px;margin: 5px;margin-top: 17px;box-shadow:4px -5px 9px 4px rgba(35,35,35,0.1), 2px 0 2px 0px rgba(10,31,68,.08);\"> <div class=\"row\"> <div style=\"width:35%\"> <a href=\""+link+"\"> <img src=\"https://veteachwebfiles.s3.ap-south-1.amazonaws.com/website_files/assets/uploads/"+video_photo+"\" alt=\"\" style=\"width: 100%; border-radius: 3px 0 0 3px;\"> </a> </div> <div style=\"width:55%\"> <a href=\""+link+"\" style=\"text-decoration:none;\"> <p style=\"padding: 10px;color: #232323;font-family: Retina,Arial,Helvetica,sans-serif;font-size: 13px;font-weight: 800;line-height: 1.29; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;\">"+video_name+"</p> </a> <p class=\"text_style2\" style=\"padding-left: 10px;font-weight: 600;\">"+view_count+"&nbsp;Views</p> </div> </div> </div>";
                }else{
                   var link = "?url=video_view&video_id="+video_id+"&unit_id="+unit_id_url+"&semester_id="+semester_id+"&subject_id="+subject_id;
                    div_to_append.innerHTML += "<div class=\"video-wrapper top-video-wrapper pt_video_side_vids pt_pt_mn_wtch_rltvids\" data-sidebar-video=\"4\"> <div class=\"video-thumb\"> <a href=\""+link+"\" data-load=\"?link1=watch&id=loMH8tyCJFJpt3O\"> <img src=\"https://veteachwebfiles.s3.ap-south-1.amazonaws.com/website_files/assets/uploads/"+video_photo+"\" alt=\""+video_name+"\"> <div class=\"play_hover_btn\" > <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-play-circle\"> <circle cx=\"12\" cy=\"12\" r=\"10\"></circle> <polygon points=\"10 8 16 12 10 16 10 8\"></polygon> </svg> </div></a> </div> <div class=\"video-title\" style=\"text-align:center;\"> <a style=\"font-size:13px;\" href=\""+link+"\" data-load=\"?link1=watch&id=loMH8tyCJFJpt3O\" >"+video_name+"</a> </div> <div class=\"vid_pub_info\" style=\"display:none;\"> <a href=\""+link+"\" data-load=\"?link1=timeline&id=deendoughouz\"><span class=\"video-publisher\"> <img src=\"https://veteachwebfiles.s3.ap-south-1.amazonaws.com/website_files/assets/uploads/"+video_photo+"\"alt=\""+video_name+"\">..</span></a> <span class=\"bold\">|</span> <span class=\"video-views\">"+view_count+" Views</span> </div> <div class=\"clear\"></div> </div>";
                }

            }else if(unit_id_url == unit_num){
                if(url_page == "mobile_video_view"){
                    var link = "?url=mobile_video_view&video_id="+video_id+"&unit_id="+unit_id_url+"&semester_id="+semester_id+"&subject_id="+subject_id;
                    div_to_append.innerHTML += "<div class=\"col-md-12\" style=\"padding: 0px;margin: 5px;margin-top: 17px;box-shadow:4px -5px 9px 4px rgba(35,35,35,0.1), 2px 0 2px 0px rgba(10,31,68,.08);\"> <div class=\"row\"> <div style=\"width:35%\"> <a href=\""+link+"\"> <img src=\"https://veteachwebfiles.s3.ap-south-1.amazonaws.com/website_files/assets/uploads/"+video_photo+"\" alt=\"\" style=\"width: 100%; border-radius: 3px 0 0 3px;\"> </a> </div> <div style=\"width:55%\"> <a href=\""+link+"\" style=\"text-decoration:none;\"> <p style=\"padding: 10px;color: #232323;font-family: Retina,Arial,Helvetica,sans-serif;font-size: 13px;font-weight: 800;line-height: 1.29; overflow: hidden; text-overflow: ellipsis; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;\">"+video_name+"</p> </a> <p class=\"text_style2\" style=\"padding-left: 10px;font-weight: 600;\">"+view_count+"&nbsp;Views</p> </div> </div> </div>";
                }else{
                    var link = "?url=video_view&video_id="+video_id+"&semester_id="+semester_id+"&subject_id="+subject_id;
                    div_to_append.innerHTML += "<div class=\"video-wrapper top-video-wrapper pt_video_side_vids pt_pt_mn_wtch_rltvids\" data-sidebar-video=\"4\"> <div class=\"video-thumb\"> <a href=\""+link+"\" data-load=\"?link1=watch&id=loMH8tyCJFJpt3O\"> <img src=\"https://veteachwebfiles.s3.ap-south-1.amazonaws.com/website_files/assets/uploads/"+video_photo+"\" alt=\""+video_name+"\"> <div class=\"play_hover_btn\" > <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" class=\"feather feather-play-circle\"> <circle cx=\"12\" cy=\"12\" r=\"10\"></circle> <polygon points=\"10 8 16 12 10 16 10 8\"></polygon> </svg> </div></a> </div> <div class=\"video-title\" style=\"text-align:center;\"> <a style=\"font-size:13px;\" href=\""+link+"\" data-load=\"?link1=watch&id=loMH8tyCJFJpt3O\" >"+video_name+"</a> </div> <div class=\"vid_pub_info\" style=\"display:none;\"> <a href=\""+link+"\" data-load=\"?link1=timeline&id=deendoughouz\"><span class=\"video-publisher\"> <img src=\"https://veteachwebfiles.s3.ap-south-1.amazonaws.com/website_files/assets/uploads/"+video_photo+"\"alt=\""+video_name+"\">..</span></a> <span class=\"bold\">|</span> <span class=\"video-views\">"+view_count+" Views</span> </div> <div class=\"clear\"></div> </div>";
                }

            }
        }
    }

    function fetchVideos($subject_id){
        console.log($subject_id+"subject_id");//undefined
        var data = {
            cmd:105,
            subject_id:$subject_id,
        }
        // console.log($subject_id);
        sendRequest(data,105,0,0)
    }

    function logout1() {
        // var cookies = document.cookie.split(";");
        //
        // for (var i = 0; i < cookies.length; i++) {
        //     var cookie = cookies[i];
        //     var eqPos = cookie.indexOf("=");
        //     var name = eqPos > -1 ? cookie.substr(0, eqPos) : cookie;
        //     document.cookie = name + "=;expires=Thu, 01 Jan 1970 00:00:00 GMT";
        // }
        // sessionStorage.clear();
        // localStorage.clear();
        // indexedDB.databases().then(dbs => {
        //   dbs.forEach(db => indexedDB.deleteDatabase(db.name))
        // });
        //
        // // Cookies.remove("branch_id");
        // // Cookies.remove("semester_id");
        // // Cookies.remove("version");
        // document.cookie = "branch_id='';expires=Thu, 01-Jan-1970 00 :00:01 GMT;path=/";
        // document.cookie = "semester_id='';expires=Thu, 01-Jan-1970 00 :00:01 GMT;path=/";
        // document.cookie = "version='';expires=Thu, 01-Jan-1970 00 :00:01 GMT;path=/";
        // window.location.href = '?url=index';
    }

    function userData(){
    	console.log("userData-222222222222222222");

        let tx = db.transaction(['users'], 'readonly');
        let store = tx.objectStore('users');
        // Create a cursor request to get all items in the store, which
        // we collect in the allsubject array
        let req = store.openCursor();
        let allusers = [];
        var countRequest = store.count();
        countRequest.onsuccess = function() {
          console.log(countRequest.result);
          if(countRequest.result>0){
                actionForUserData(true);
            }else{
                actionForUserData(false);
            }
        }

        req.onsuccess = function(event) {
            // // The result of req.onsuccess is an IDBCursor
            // let cursor = event.target.result;
            // if (cursor != null) {
            //   // If the cursor isn't null, we got an IndexedDB item.
            //   // Add it to the note array and have the cursor continue!
            //   allusers.push(cursor.value);
            //   cursor.continue();
            // } else {
            //   // If we have a null cursor, it means we've gotten
            //   // all the items in the store, so display the subject we got
            //   displaysubject(allsubject);
            // }

        }
        req.onerror = function(event) {
            // alert('error in cursor request ' + event.target.errorCode);
            actionForUserData(false);
        }
    }

    function actionForUserData($isLoggedIn){
    	console.log("actionForUserData-333333333333333333333--");

    	// if(!$isLoggedIn){//not logged in
    	// 	document.getElementById('usernotloggedin').style.display = 'block';
    	// 	document.getElementById('userloggedin').style.display = 'none';
        //
    	// }else{
    	// 	document.getElementById('userloggedin').style.display = 'block';
    	// 	document.getElementById('usernotloggedin').style.display = 'none';
    	// }
    }

    function createVersion(result){
    	// console.log("createVersion-911111111111111111111111");
        var version = result;
        document.cookie = "version" + "=" + version + ";path=/";
        // console.log(getCookie("version")+"###############")

        fetchSubject(1);
    }

    function getVersion(){
        console.log("getVersion-8888888888888888888888");
        let tx = db.transaction(['users'], 'readonly');
        let store = tx.objectStore('users');
        // Create a cursor request to get all items in the store, which
        // we collect in the allsubject array
        let req = store.openCursor();
        // let dbversion = [];

        req.onsuccess = function(event) {
            var dbversionn;
            // The result of req.onsuccess is an IDBCursor
            let cursor = event.target.result;
            if (cursor != null) {
              // If the cursor isn't null, we got an IndexedDB item.
              // Add it to the note array and have the cursor continue!
              // allusers.push(cursor.value);
                console.log("cursor value-"+cursor.value);
              dbversionn = cursor.value;
              cursor.continue();
            } else {
              // If we have a null cursor, it means we've gotten
              // all the items in the store, so display the subject we got
                console.log("cursor value11111-");
                dbversionn = -3;
                console.log("db version-"+dbversionn);
                return dbversionn;
            }
            if(store.count()==0){
                console.log("cursor value22222222-");
                dbversionn = 0;
                console.log("db version-"+dbversionn);
                return dbversion;
            }
        }
        req.onerror = function(event) {
            var dbversionn;
            // alert('error in cursor request ' + event.target.errorCode);
            dbversionn = -2;
            console.log("cursor value333333333-");
            console.log("db version-"+dbversionn);
                return dbversionn;
        }

        console.log("db version-"+window.dbversion);
        return dbversion;
    }

    function insertUserDetails(user_id,email,user_name,profile_pic,phone){

        // Start a database transaction and get the subject object store
        let tx = db.transaction(['users'], 'readwrite');
        let store = tx.objectStore('users');
        // Put the sticky note into the object store
        let note = {user_id: user_id,email:email, user_name: user_name,profile_pic:profile_pic,phone:phone};
        store.add(note);
        // Wait for the database transaction to complete
        tx.oncomplete = function() {
            console.log('stored note!');
            userData();
        }
        tx.onerror = function(event) {
            alert('error storing note ' + event.target.errorCode);
        }
    }

    function onSignIn(googleUser) {
        console.log("*****************2");
        // alert("ds2");
        // Useful data for your client-side scripts:
        var profile = googleUser.getBasicProfile();
        // console.log("ID: " + profile.getId()); // Don't send this directly to your server!
        // console.log('Full Name: ' + profile.getName());
        // console.log('Given Name: ' + profile.getGivenName());
        // console.log('Family Name: ' + profile.getFamilyName());
        // console.log("Image URL: " + profile.getImageUrl());
        // console.log("Email: " + profile.getEmail());
        // alert("ID: " + profile.getId())
        // alert('Full Name: ' + profile.getName())
        // alert('Given Name: ' + profile.getGivenName())
        // alert("Image URL: " + profile.getImageUrl())
        // closeLogin();
        // document.getElementById('myLoginpage').style.display='none';
        document.getElementById('modalOverlay').style.display='none';


        document.cookie = "user_name=" + profile.getName() + ";path=/";
        document.cookie = "user_email=" + profile.getEmail() + ";path=/";
        document.cookie = "user_phone=" + "" + ";path=/";
        document.cookie = "user_referral=" + "" + ";path=/";





        let tx = db.transaction(['users'], 'readonly');
        let store = tx.objectStore('users');
        // Create a cursor request to get all items in the store, which
        // we collect in the allsubject array
        let req = store.openCursor();
        let allusers = [];
        var countRequest = store.count();

        countRequest.onsuccess = function() {
          console.log(countRequest.result);
          if(countRequest.result==0){
              data = {
                cmd:101,
                email:profile.getEmail(),
                fcm_token:"",
                phone:"",
                name:profile.getName()
            }
            send_data = []
            send_data[0] = profile.getEmail();
            send_data[1] = profile.getName();
            send_data[2] = profile.getImageUrl();
            sendRequest(data,101,send_data,0);
          }
        }

    }
</script>